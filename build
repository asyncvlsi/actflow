#!/bin/sh

if [ x$ACT_HOME = x ]
then
	echo "Please set the environment variable ACT_HOME to the install directory"
        exit 1
fi

if [ x$LLVM_DIR = x ]
then
	echo "Please set the environment variavble LLVM_DIR to the directory containing LLVMConfig.cmake"
	exit 1
fi

cmake_build() {
  dir=$1
  echo 
  echo "#### Building and installing package: $1 ####"
  echo
  (cd $dir; if [ ! -d build ]; then mkdir build; fi; cd build; cmake -DCMAKE_INSTALL_PREFIX=$ACT_HOME .. && make && make install)
}

cmake_build_bipart() {
  dir=BiPart
  echo
  echo "#### Building and installing package: $1 ####"
  echo
  (cd BiPart; if [ ! -d build ]; then mkdir build; fi; cd build; LEF_ROOT=$ACT_HOME GALOIS_INCLUDE=$ACT_HOME/include GALOIS_LIB=$ACT_HOME/lib DEF_ROOT=$ACT_HOME cmake -DCMAKE_INSTALL_PREFIX=$ACT_HOME ..  && make && make install)
}

#
# Apply patches
#
echo "Applying patch to Galois library..."
(cd Galois; patch -p0 < ../extra/Galois)

#
# Build and install the ACT library
#
echo
echo "####  Building and installing the core ACT library ####"
echo
export VLSI_TOOLS_SRC=`pwd`/act
(cd act; ./configure $ACT_HOME; ./build; make install)

#
# Build and install the Galois library
#
cmake_build Galois

#
# Build and install the LEF/DEF library
#
echo
echo "####  Building and installing the LEF/DEF parser ####"
echo
(cd lefdef; make && make install)

#
# Build and install... 

# phyDB
cmake_build phyDB

# BiPart
cmake_build_bipart

# Dali
cmake_build Dali

# PWRoute
cmake_build PWRoute

# SPRoute
cmake_build SPRoute

# TritonRoute-WXL
cmake_build TritonRoute-WXL

# interact
echo
echo "#### Building interact ####"
echo
(cd interact; ./configure; make depend && make && make install)
